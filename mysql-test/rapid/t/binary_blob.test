--disable_query_log
eval INSTALL PLUGIN rapid SONAME 'ha_rapid.so';
--enable_query_log

--echo #
--echo # Test RAPID binary BLOB support
--echo #

CREATE TABLE t_blob (
  id INT PRIMARY KEY,
  text_data TEXT,
  binary_data BLOB,
  tiny_blob TINYBLOB,
  medium_blob MEDIUMBLOB
) SECONDARY_ENGINE RAPID;

--echo # Insert text data
INSERT INTO t_blob (id, text_data) VALUES (1, 'This is text data');

--echo # Insert binary data with null bytes
INSERT INTO t_blob (id, binary_data) VALUES (2, X'00010203040506070809');

--echo # Insert mixed data
INSERT INTO t_blob (id, text_data, binary_data) VALUES (3, 'Text', X'DEADBEEF');

--echo # Insert tiny blob
INSERT INTO t_blob (id, tiny_blob) VALUES (4, X'FF');

--echo # Insert medium blob with various bytes
INSERT INTO t_blob (id, medium_blob) VALUES (5, X'48656C6C6F20576F726C6400');

ALTER TABLE t_blob SECONDARY_LOAD;

SET SESSION secondary_engine_cost_threshold = 0;

--echo # Count records (HEX function not supported by DuckDB, so we just count)
SELECT COUNT(*) FROM t_blob;

ALTER TABLE t_blob SECONDARY_UNLOAD;
DROP TABLE t_blob;

--disable_query_log
UNINSTALL PLUGIN rapid;
--enable_query_log
