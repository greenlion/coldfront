--disable_query_log
eval INSTALL PLUGIN rapid SONAME 'ha_rapid.so';
--enable_query_log

--echo #
--echo # Test RAPID with aggregate functions
--echo #

CREATE TABLE t1 (
  id INT,
  category VARCHAR(50),
  amount DECIMAL(10,2)
) SECONDARY_ENGINE RAPID;

INSERT INTO t1 VALUES
  (1, 'A', 100.50),
  (2, 'B', 200.75),
  (3, 'A', 150.25),
  (4, 'B', 300.00),
  (5, 'A', 175.50);

ALTER TABLE t1 SECONDARY_LOAD;

SET SESSION secondary_engine_cost_threshold = 0;

--echo # Test COUNT
SELECT COUNT(*) FROM t1;

--echo # Test SUM
SELECT SUM(amount) FROM t1;

--echo # Test AVG
SELECT AVG(amount) FROM t1;

--echo # Test MIN/MAX
SELECT MIN(amount), MAX(amount) FROM t1;

--echo # Test GROUP BY
SELECT category, COUNT(*), SUM(amount) FROM t1 GROUP BY category ORDER BY category;

DROP TABLE t1;

--disable_query_log
UNINSTALL PLUGIN rapid;
--enable_query_log
